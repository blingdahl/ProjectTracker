class GlobalController {

  // SECTION:
  // Elements
  
  static getShowOverviewElement() {
    return $('.showOverview');
  }
  
  static getDoAllTheThingsElement() {
    return $('.doAllTheThings');
  }
  
  // SECTION:
  // Attributes
  
  static getSpreadsheetUrl() {
    return $('[data-spreadsheet-url]').attr('data-spreadsheet-url');
  }

  // SECTION:
  // Click handlers
  
  static makeLink(rowData, key) {
    return $('<a />').attr('href', rowData[key + '_URL']).attr('target', '_NEW').text(rowData[key]);
  }
  
  static handleOverviewData(msg) {
    let data = JSON.parse(msg);
    let overviewTableTemplate = $('.overviewTableTemplate');
    let overviewRowTemplate = overviewTableTemplate.find('.overviewRowTemplate');
    let overviewTable = overviewTableTemplate.clone().removeClass('overviewTableTemplate');
    overviewTable.find('.overviewRowTemplate').remove();
    data.forEach(rowData => {
      let overviewRow = overviewRowTemplate.clone().removeClass('overviewRowTemplate');
      overviewRow.find('.sheet').append(GlobalController.makeLink(rowData, 'SHEET'));
      overviewRow.find('.item').text(rowData['ITEM']);
      overviewRow.find('.priority').text(rowData['PRIORITY']);
      overviewRow.find('.email').append(GlobalController.makeLink(rowData, 'EMAIL'));
      overviewRow.find('.link').append(GlobalController.makeLink(rowData, 'LINK'));
      overviewTable.append(overviewRow);
    });
    $('.overviewPlaceholder').append(overviewTable.show());
  }
  
  static showOverview() {
    $('.controls').hide();
    new RpcConfig(runner => runner.getOverviewRows(GlobalController.getSpreadsheetUrl())).
        output('Loading overview...').
        clearMessageOnSuccess().
        withSuccessFn(GlobalController.handleOverviewData).
        callRpc();
  }

  static addListeners() {
    GlobalController.getShowOverviewElement().click(GlobalController.showOverview);
    GlobalController.getDoAllTheThingsElement().click(GlobalController.doAllTheThings);
  }
  
  static init() {
    GlobalController.addListeners();
  }
}
