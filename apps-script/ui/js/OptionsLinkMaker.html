class OptionsLinkMaker {
  constructor(allValues, emptyText, linkClass, changeCallback) {
    this.allValues = allValues;
    this.emptyText = emptyText;
    this.linkClass = linkClass;
    this.changeCallback = changeCallback;
  }
  
  // Called once per table load
  attachClickHandler(ancestorJq) {
    ancestorJq.on('click', '.' + this.linkClass, this.linkClicked.bind(this));
  }
  
  makeLinkText(currValue) {
    return currValue || this.emptyText;
  }
  
  makeLink(currValue) {
    let link = $('<a />');
    link.text(this.makeLinkText(currValue));
    link.addClass(this.linkClass);
    link.attr('data-value', currValue);
    return link;
  }
  
  linkClicked(e) {
    var link = $(e.currentTarget);
    link.parent().append(this.makeOptions(link.attr('data-value'), link));
    link.hide();
  }
  
  makeOptions(currValue, link) {
    let options = $('<select />');
    for (var i = 0; i != this.allValues.length; i++) {
      let optionValue = this.allValues[i];
      options.append($('<option />').attr('value', optionValue).attr('selected', currValue === optionValue).text(optionValue || this.emptyText));
    }
    options.change(() => {
      var newValue = options.val();
      options.remove();
      this.changeCallback(link, newValue);
      link.attr('data-value', newValue);
      link.text(this.makeLinkText(newValue)).show();
    });
    return options;
  }
}
