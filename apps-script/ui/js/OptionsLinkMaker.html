class OptionsLinkMaker {
  constructor(allValues, emptyText, linkClass, changeCallback) {
    this.allValues = allValues;
    this.emptyText = emptyText;
    this.linkClass = linkClass;
    this.changeCallback = changeCallback;
  }
  
  // Called once per table load
  attachClickHandler(ancestorJq) {
    ancestorJq.on('click', '.' + this.linkClass, this.linkClicked.bind(this));
  }
  
  makeLinkText(currText) {
    return currText || this.emptyText;
  }
  
  makeLink(currValue, opt_currText) {
    let link = $('<a />');
    if(!opt_currText) {
      opt_currText = currValue;
    }
    link.text(this.makeLinkText(opt_currText));
    link.addClass(this.linkClass);
    link.addClass('editableField');
    link.attr('data-value', currValue);
    link.attr('data-text', opt_currText);
    return link;
  }
  
  linkClicked(e) {
    var link = $(e.currentTarget);
    link.parent().append(this.makeOptions(link.attr('data-value'), link));
    link.hide();
  }
  
  makeOptions(currValue, link) {
    let options = $('<div />').addClass('linkOptions');
    for (var i = 0; i != this.allValues.length; i++) {
      let optionValue = this.allValues[i];
      let text;
      let value = optionValue;
      if (typeof optionValue === 'string') {
        text = optionValue || this.emptyText;
        value = optionValue;
      } else {
        text = optionValue.text;
        value = optionValue.value;
      }
      let option = $('<div />').attr('data-value', value).attr('data-text', text).text(text);
      console.log('currValue', currValue);
      console.log('value', value);
      if (currValue == value) {
        option.addClass('currValue');
      }
      options.append(option);
      option.click((event) => {
        let jq = $(event.currentTarget);
        let newValue = jq.attr('data-value');
        let newText = jq.text();
        options.remove();
        this.changeCallback(link, newValue);
        link.attr('data-text', newText);
        link.attr('data-value', newValue);
        link.text(this.makeLinkText(newText)).show();
      });
    }
    return options;
  }
}
