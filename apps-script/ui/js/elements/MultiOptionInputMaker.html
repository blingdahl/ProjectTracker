class MultiOptionInputMaker {
  constructor(allValues, textCallback) {
    this.allValues = allValues;
    this.textCallback = textCallback;
  }
  
  makeElement(currValues, changeCallback, cancelCallback) {
    let buttonsJq = $('<div />').addClass('buttons');
    let applyJq = $('<span />').text('Apply').addClass('apply').addClass('button');
    applyJq.click((event) => {
      let applyJq = $(event.currentTarget);
      let newValues = [];
      optionsJq.find('[data-selected="true"]').each((index, elt) => {
        let optionJq = $(elt);
        newValues.push(optionJq.attr('data-value'));
      });
      optionsJq.remove();
      changeCallback(newValues);
    });
    let clearJq = $('<span />').text('Clear').addClass('clear').addClass('button');
    clearJq.click((event) => {
      optionsJq.find('.option').attr('data-selected', 'false');
    });
    let allJq = $('<span />').text('All').addClass('all').addClass('button');
    allJq.click((event) => {
      optionsJq.find('.option').attr('data-selected', 'true');
    });
    let cancelJq = $('<span />').text('Cancel').addClass('cancel').addClass('button');
    cancelJq.click((event) => {
      optionsJq.remove();
      cancelCallback();
    });
    buttonsJq.append(applyJq);
    buttonsJq.append($('<span />').addClass('betweenButtons'));
    buttonsJq.append(clearJq);
    buttonsJq.append($('<span />').addClass('betweenButtons'));
    buttonsJq.append(allJq);
    buttonsJq.append($('<span />').addClass('betweenButtons'));
    buttonsJq.append(cancelJq);
    let optionsJq = $('<div />').addClass('multiOptionPicker');
    for (var i = 0; i != this.allValues.length; i++) {
      let value = this.allValues[i];
      let text = this.textCallback(value);
      let optionJq = $('<div />').
          attr('data-value', value).
          attr('data-text', text).
          addClass('option');
      let checkJq = $('<span>&check;</span>').addClass('check');
      let textJq = $('<span />').text(text).addClass('text');
      let onlyJq = $('<span />').text('Only').addClass('only');
      optionJq.append(checkJq).append(textJq).append(' (').append(onlyJq).append(')');
      if (currValues.some(currValue => value == currValue)) {
        optionJq.attr('data-selected', 'true');
      }
      optionsJq.append(optionJq);
      onlyJq.click((event) => {
        optionsJq.find('.option').attr('data-selected', 'false');
        optionJq.attr('data-selected', 'true');
        applyJq.click();
        event.stopPropagation();
      });
      optionJq.click((event) => {
        let optionJq = $(event.currentTarget);
        if (optionJq.attr('data-selected') == 'true') {
          optionJq.attr('data-selected', 'false');
        } else {
          optionJq.attr('data-selected', 'true');
        }
      });
    }
    optionsJq.append(buttonsJq);
    return optionsJq;
  }
}
