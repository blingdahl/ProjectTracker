class EditableTextMaker {
  constructor(textCssClass, emptyText, textCallback, valueCallback, changeCallback, inputMaker) {
    this.textCssClass = textCssClass;
    this.emptyText = emptyText;
    this.textCallback = textCallback;
    this.valueCallback = valueCallback;
    this.changeCallback = changeCallback;
    this.inputMaker = inputMaker;
  }
  
  // Called once per table load
  attachClickHandler(ancestorJq) {
    ancestorJq.on('click', '.' + this.textCssClass, this.textClicked.bind(this));
  }
  
  textClicked(e) {
    var textJq = $(e.currentTarget);
    let input = this.inputMaker.makeElement(textJq.attr('data-value'),
        (newValue, newText) => {
          this.changeCallback(textJq, newValue);
          textJq.attr('data-value', newValue).text(newText || this.emptyText).show();
        },
        () => textJq.show());
    textJq.parent().append(input);
    input.focus();
    textJq.hide();
  }
  
  makeElement(data) {
    return $('<span />').
        addClass(this.textCssClass).
        addClass('editableText').
        text(this.textCallback(data) || this.emptyText).
        attr('data-value', this.valueCallback(data));
  }
}
